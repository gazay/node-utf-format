// U+1D400 - U+1D433
const BOLD = {
  a: 'ðš', b: 'ð›', c: 'ðœ', d: 'ð', e: 'ðž', f: 'ðŸ', g: 'ð ', h: 'ð¡', i: 'ð¢', j: 'ð£',
  k: 'ð¤', l: 'ð¥', m: 'ð¦', n: 'ð§', o: 'ð¨', p: 'ð©', q: 'ðª', r: 'ð«', s: 'ð¬', t: 'ð­',
  u: 'ð®', v: 'ð¯', w: 'ð°', x: 'ð±', y: 'ð²', z: 'ð³',
  A: 'ð€', B: 'ð', C: 'ð‚', D: 'ðƒ', E: 'ð„', F: 'ð…', G: 'ð†', H: 'ð‡', I: 'ðˆ', J: 'ð‰',
  K: 'ðŠ', L: 'ð‹', M: 'ðŒ', N: 'ð', O: 'ðŽ', P: 'ð', Q: 'ð', R: 'ð‘', S: 'ð’', T: 'ð“',
  U: 'ð”', V: 'ð•', W: 'ð–', X: 'ð—', Y: 'ð˜', Z: 'ð™',
  // U+1D7CE - U+1D7D7
  0: 'ðŸŽ', 1: 'ðŸ', 2: 'ðŸ', 3: 'ðŸ‘', 4: 'ðŸ’', 5: 'ðŸ“', 6: 'ðŸ”', 7: 'ðŸ•', 8: 'ðŸ–', 9: 'ðŸ—',
};

// U+1D434 - U+1D467
const ITALIC = {
  a: 'ð‘Ž', b: 'ð‘', c: 'ð‘', d: 'ð‘‘', e: 'ð‘’', f: 'ð‘“', g: 'ð‘”', h: 'ð’‰', i: 'ð‘–', j: 'ð‘—',
  k: 'ð‘˜', l: 'ð‘™', m: 'ð‘š', n: 'ð‘›', o: 'ð‘œ', p: 'ð‘', q: 'ð‘ž', r: 'ð‘Ÿ', s: 'ð‘ ', t: 'ð‘¡',
  u: 'ð‘¢', v: 'ð‘£', w: 'ð‘¤', x: 'ð‘¥', y: 'ð‘¦', z: 'ð‘§',
  A: 'ð´', B: 'ðµ', C: 'ð¶', D: 'ð·', E: 'ð¸', F: 'ð¹', G: 'ðº', H: 'ð»', I: 'ð¼', J: 'ð½',
  K: 'ð¾', L: 'ð¿', M: 'ð‘€', N: 'ð‘', O: 'ð‘‚', P: 'ð‘ƒ', Q: 'ð‘„', R: 'ð‘…', S: 'ð‘†', T: 'ð‘‡',
  U: 'ð‘ˆ', V: 'ð‘‰', W: 'ð‘Š', X: 'ð‘‹', Y: 'ð‘Œ', Z: 'ð‘',
  // Normal numbers
  0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9',
};

// U+1D468 - U+1D49B
const BOLD_ITALIC = {
  a: 'ð’‚', b: 'ð’ƒ', c: 'ð’„', d: 'ð’…', e: 'ð’†', f: 'ð’‡', g: 'ð’ˆ', h: 'ð’‰', i: 'ð’Š', j: 'ð’‹',
  k: 'ð’Œ', l: 'ð’', m: 'ð’Ž', n: 'ð’', o: 'ð’', p: 'ð’‘', q: 'ð’’', r: 'ð’“', s: 'ð’”', t: 'ð’•',
  u: 'ð’–', v: 'ð’—', w: 'ð’˜', x: 'ð’™', y: 'ð’š', z: 'ð’›',
  A: 'ð‘¨', B: 'ð‘©', C: 'ð‘ª', D: 'ð‘«', E: 'ð‘¬', F: 'ð‘­', G: 'ð‘®', H: 'ð‘¯', I: 'ð‘°', J: 'ð‘±',
  K: 'ð‘²', L: 'ð‘³', M: 'ð‘´', N: 'ð‘µ', O: 'ð‘¶', P: 'ð‘·', Q: 'ð‘¸', R: 'ð‘¹', S: 'ð‘º', T: 'ð‘»',
  U: 'ð‘¼', V: 'ð‘½', W: 'ð‘¾', X: 'ð‘¿', Y: 'ð’€', Z: 'ð’',
  // U+1D7CE - U+1D7D7
  0: 'ðŸŽ', 1: 'ðŸ', 2: 'ðŸ', 3: 'ðŸ‘', 4: 'ðŸ’', 5: 'ðŸ“', 6: 'ðŸ”', 7: 'ðŸ•', 8: 'ðŸ–', 9: 'ðŸ—',
};

// U+1D4D0 - U+1D503
const BOLD_SCRIPT = {
  a: 'ð“ª', b: 'ð“«', c: 'ð“¬', d: 'ð“­', e: 'ð“®', f: 'ð“¯', g: 'ð“°', h: 'ð“±', i: 'ð“²', j: 'ð“³',
  k: 'ð“´', l: 'ð“µ', m: 'ð“¶', n: 'ð“·', o: 'ð“¸', p: 'ð“¹', q: 'ð“º', r: 'ð“»', s: 'ð“¼', t: 'ð“½',
  u: 'ð“¾', v: 'ð“¿', w: 'ð”€', x: 'ð”', y: 'ð”‚', z: 'ð”ƒ',
  A: 'ð“', B: 'ð“‘', C: 'ð“’', D: 'ð““', E: 'ð“”', F: 'ð“•', G: 'ð“–', H: 'ð“—', I: 'ð“˜', J: 'ð“™',
  K: 'ð“š', L: 'ð“›', M: 'ð“œ', N: 'ð“', O: 'ð“ž', P: 'ð“Ÿ', Q: 'ð“ ', R: 'ð“¡', S: 'ð“¢', T: 'ð“£',
  U: 'ð“¤', V: 'ð“¥', W: 'ð“¦', X: 'ð“§', Y: 'ð“¨', Z: 'ð“©',
  // U+1D7CE - U+1D7D7
  0: 'ðŸŽ', 1: 'ðŸ', 2: 'ðŸ', 3: 'ðŸ‘', 4: 'ðŸ’', 5: 'ðŸ“', 6: 'ðŸ”', 7: 'ðŸ•', 8: 'ðŸ–', 9: 'ðŸ—',
};

// U+1D5A0 - U+1D5D3
const SS_REGULAR = {
  A: 'ð– ', B: 'ð–¡', C: 'ð–¢', D: 'ð–£', E: 'ð–¤', F: 'ð–¥', G: 'ð–¦', H: 'ð–§', I: 'ð–¨', J: 'ð–©',
  K: 'ð–ª', L: 'ð–«', M: 'ð–¬', N: 'ð–­', O: 'ð–®', P: 'ð–¯', Q: 'ð–°', R: 'ð–±', S: 'ð–²', T: 'ð–³',
  U: 'ð–´', V: 'ð–µ', W: 'ð–¶', X: 'ð–·', Y: 'ð–¸', Z: 'ð–¹',
  a: 'ð–º', b: 'ð–»', c: 'ð–¼', d: 'ð–½', e: 'ð–¾', f: 'ð–¿', g: 'ð—€', h: 'ð—', i: 'ð—‚', j: 'ð—ƒ',
  k: 'ð—„', l: 'ð—…', m: 'ð—†', n: 'ð—‡', o: 'ð—ˆ', p: 'ð—‰', q: 'ð—Š', r: 'ð—‹', s: 'ð—Œ', t: 'ð—',
  u: 'ð—Ž', v: 'ð—', w: 'ð—', x: 'ð—‘', y: 'ð—’', z: 'ð—“',
  // U+1D7E2 - U+1D7EB
  0: 'ðŸ¢', 1: 'ðŸ£', 2: 'ðŸ¤', 3: 'ðŸ¥', 4: 'ðŸ¦', 5: 'ðŸ§', 6: 'ðŸ¨', 7: 'ðŸ©', 8: 'ðŸª', 9: 'ðŸ«',
};

// U+1D5D4 - U+1D607
const SS_BOLD = {
  A: 'ð—”', B: 'ð—•', C: 'ð—–', D: 'ð——', E: 'ð—˜', F: 'ð—™', G: 'ð—š', H: 'ð—›', I: 'ð—œ', J: 'ð—',
  K: 'ð—ž', L: 'ð—Ÿ', M: 'ð— ', N: 'ð—¡', O: 'ð—¢', P: 'ð—£', Q: 'ð—¤', R: 'ð—¥', S: 'ð—¦', T: 'ð—§',
  U: 'ð—¨', V: 'ð—©', W: 'ð—ª', X: 'ð—«', Y: 'ð—¬', Z: 'ð—­',
  a: 'ð—®', b: 'ð—¯', c: 'ð—°', d: 'ð—±', e: 'ð—²', f: 'ð—³', g: 'ð—´', h: 'ð—µ', i: 'ð—¶', j: 'ð—·',
  k: 'ð—¸', l: 'ð—¹', m: 'ð—º', n: 'ð—»', o: 'ð—¼', p: 'ð—½', q: 'ð—¾', r: 'ð—¿', s: 'ð˜€', t: 'ð˜',
  u: 'ð˜‚', v: 'ð˜ƒ', w: 'ð˜„', x: 'ð˜…', y: 'ð˜†', z: 'ð˜‡',
  // U+1D7EC - U+1D7F5
  0: 'ðŸ¬', 1: 'ðŸ­', 2: 'ðŸ®', 3: 'ðŸ¯', 4: 'ðŸ°', 5: 'ðŸ±', 6: 'ðŸ²', 7: 'ðŸ³', 8: 'ðŸ´', 9: 'ðŸµ',
};

// U+1D608 - U+1D63B
const SS_ITALIC = {
  A: 'ð˜ˆ', B: 'ð˜‰', C: 'ð˜Š', D: 'ð˜‹', E: 'ð˜Œ', F: 'ð˜', G: 'ð˜Ž', H: 'ð˜', I: 'ð˜', J: 'ð˜‘',
  K: 'ð˜’', L: 'ð˜“', M: 'ð˜”', N: 'ð˜•', O: 'ð˜–', P: 'ð˜—', Q: 'ð˜˜', R: 'ð˜™', S: 'ð˜š', T: 'ð˜›',
  U: 'ð˜œ', V: 'ð˜', W: 'ð˜ž', X: 'ð˜Ÿ', Y: 'ð˜ ', Z: 'ð˜¡',
  a: 'ð˜¢', b: 'ð˜£', c: 'ð˜¤', d: 'ð˜¥', e: 'ð˜¦', f: 'ð˜§', g: 'ð˜¨', h: 'ð˜©', i: 'ð˜ª', j: 'ð˜«',
  k: 'ð˜¬', l: 'ð˜­', m: 'ð˜®', n: 'ð˜¯', o: 'ð˜°', p: 'ð˜±', q: 'ð˜²', r: 'ð˜³', s: 'ð˜´', t: 'ð˜µ',
  u: 'ð˜¶', v: 'ð˜·', w: 'ð˜¸', x: 'ð˜¹', y: 'ð˜º', z: 'ð˜»',
  // U+1D7E2 - U+1D7EB
  0: 'ðŸ¢', 1: 'ðŸ£', 2: 'ðŸ¤', 3: 'ðŸ¥', 4: 'ðŸ¦', 5: 'ðŸ§', 6: 'ðŸ¨', 7: 'ðŸ©', 8: 'ðŸª', 9: 'ðŸ«',
};

// U+1D63C - U+1D66F
const SS_BOLD_ITALIC = {
  A: 'ð˜¼', B: 'ð˜½', C: 'ð˜¾', D: 'ð˜¿', E: 'ð™€', F: 'ð™', G: 'ð™‚', H: 'ð™ƒ', I: 'ð™„', J: 'ð™…',
  K: 'ð™†', L: 'ð™‡', M: 'ð™ˆ', N: 'ð™‰', O: 'ð™Š', P: 'ð™‹', Q: 'ð™Œ', R: 'ð™', S: 'ð™Ž', T: 'ð™',
  U: 'ð™', V: 'ð™‘', W: 'ð™’', X: 'ð™“', Y: 'ð™”', Z: 'ð™•',
  a: 'ð™–', b: 'ð™—', c: 'ð™˜', d: 'ð™™', e: 'ð™š', f: 'ð™›', g: 'ð™œ', h: 'ð™', i: 'ð™ž', j: 'ð™Ÿ',
  k: 'ð™ ', l: 'ð™¡', m: 'ð™¢', n: 'ð™£', o: 'ð™¤', p: 'ð™¥', q: 'ð™¦', r: 'ð™§', s: 'ð™¨', t: 'ð™©',
  u: 'ð™ª', v: 'ð™«', w: 'ð™¬', x: 'ð™­', y: 'ð™®', z: 'ð™¯',
  // U+1D7EC - U+1D7F5
  0: 'ðŸ¬', 1: 'ðŸ­', 2: 'ðŸ®', 3: 'ðŸ¯', 4: 'ðŸ°', 5: 'ðŸ±', 6: 'ðŸ²', 7: 'ðŸ³', 8: 'ðŸ´', 9: 'ðŸµ',
};

// U+1D670 - U+1D6A3
const MONOSPACE = {
  A: 'ð™°', B: 'ð™±', C: 'ð™²', D: 'ð™³', E: 'ð™´', F: 'ð™µ', G: 'ð™¶', H: 'ð™·', I: 'ð™¸', J: 'ð™¹',
  K: 'ð™º', L: 'ð™»', M: 'ð™¼', N: 'ð™½', O: 'ð™¾', P: 'ð™¿', Q: 'ðš€', R: 'ðš', S: 'ðš‚', T: 'ðšƒ',
  U: 'ðš„', V: 'ðš…', W: 'ðš†', X: 'ðš‡', Y: 'ðšˆ', Z: 'ðš‰',
  a: 'ðšŠ', b: 'ðš‹', c: 'ðšŒ', d: 'ðš', e: 'ðšŽ', f: 'ðš', g: 'ðš', h: 'ðš‘', i: 'ðš’', j: 'ðš“',
  k: 'ðš”', l: 'ðš•', m: 'ðš–', n: 'ðš—', o: 'ðš˜', p: 'ðš™', q: 'ðšš', r: 'ðš›', s: 'ðšœ', t: 'ðš',
  u: 'ðšž', v: 'ðšŸ', w: 'ðš ', x: 'ðš¡', y: 'ðš¢', z: 'ðš£',
  // U+1D7F6 - U+1D7FF
  0: 'ðŸ¶', 1: 'ðŸ·', 2: 'ðŸ¸', 3: 'ðŸ¹', 4: 'ðŸº', 5: 'ðŸ»', 6: 'ðŸ¼', 7: 'ðŸ½', 8: 'ðŸ¾', 9: 'ðŸ¿',
};

const AVAILABLE_TYPES = {
  b: BOLD,
  i: ITALIC,
  bi: BOLD_ITALIC,
  m: MONOSPACE,
  ss: SS_REGULAR,
  ssb: SS_BOLD,
  ssi: SS_ITALIC,
  ssbi: SS_BOLD_ITALIC,
  bs: BOLD_SCRIPT,
};

function formatAll(text, formatter) {
  return text.split('').map(ch => (formatter[ch] || ch)).join('');
}

function formatPart(part, type, symbolRegex, font) {
  const result = [];
  if (font === 'ss' && type !== 'm') {
    result.push(formatAll(part, AVAILABLE_TYPES.ss));
    result.push(formatAll(part.replace(symbolRegex, ''), AVAILABLE_TYPES[`ss${type}`]));
  } else {
    result.push(part);
    result.push(formatAll(part.replace(symbolRegex, ''), AVAILABLE_TYPES[type]));
  }
  return result;
}

function markdownParser(text, font) {
  let result = text;
  let bold = text.match(/(\*[^\*]+\*)/g);
  if (bold) {
    bold = bold.map(b => formatPart(b, 'b', /\*/g, font));
  }
  let mono = text.match(/(`[^`]+`)|(```[^`]+```)/g);
  if (mono) {
    mono = mono.map(m => formatPart(m, 'm', /`/g, font));
  }
  let italic = text.match(/(_[^_]+_)/g);
  if (italic) {
    italic = italic.map(i => formatPart(i, 'i', /_/g, font));
  }
  if (font === 'ss') {
    result = formatAll(result, AVAILABLE_TYPES.ss);
  }
  if (bold) {
    bold.forEach(repl => {
      result = result.replace(repl[0], repl[1]);
    });
  }
  if (mono) {
    mono.forEach(repl => {
      result = result.replace(repl[0], repl[1]);
    });
  }
  if (italic) {
    italic.forEach(repl => {
      result = result.replace(repl[0], repl[1]);
    });
  }
  return result;
}

const AVAILABLE_PARSERS = {
  md: markdownParser,
};

function format(text, opts = {}) {
  const formatter = AVAILABLE_TYPES[opts.to];
  const parser = AVAILABLE_PARSERS[opts.parser];
  if (formatter) {
    return formatAll(text, formatter);
  } else if (parser) {
    return parser(text, opts.font);
  }
  return markdownParser(text, opts.font);
}

module.exports = {
  format: format,
};
